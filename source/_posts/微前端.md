---
title: 微前端(插件机制)
date: 2021-06-21 10:06:13
category: NodeJS
---
### 1. 微前端是什么
微前端是一种架构风格，将独立交付的前端应用程序组合成一个更大的整体。保证产品体验的同时提升开发体验。
优势
- 不限技术栈：主框架不限制接入应用的技术栈，子应用可自主选择技术栈。
- 可独立开发部署：各个团队之间仓库独立，单独部署，互不依赖。
- 独立运行时：每个子应用之间状态隔离，运行时状态不共享。
- 增量升级：当一个应用庞大之后，技术升级或重构相当麻烦，而微应用具备渐进式升级的特性。


<br/>

### 2. 为什么要用微前端
- 打包速度：工程越来越大，打包越来越慢
- 多人多地协作：多人在同一个工程里开发，遭遇代码冲突的概率会很频繁，而且冲突的影响面比较大。
- 测试难度：由于代码都在一个仓库里，每次发布修改都会催生大面积的测试工作

<br/>

### 3.实现微前端
#### 3.1 nginx路由分发
nginx反向代理，简单快速/完全隔离，但是应用之间切换会有白屏，状态共享困难


<br/>

#### 3.2 iframe
iframe 使从独立的子页面构建页面变得很容易。它们还在样式和全局变量不相互干扰方面提供了良好的隔离程度。但他的最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来的开发体验、产品体验的问题。

缺点：
- URL 不同步。浏览器刷新 iframe url 状态丢失、后退前进按钮无法使用。
- UI 不同步，DOM 结构不共享。如无法显示整页弹窗。
- 全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果。
- 加载慢，每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程。


<br/>

#### 3.3 Module Federation插件机制
Webpack5 Module Federation（模块联邦），按需加载模块，支持动态更新

<br/>

### 4. 注意事项
- *用户登录机制*
将用户的统一登录和认证问题交给了SSO，所有的项目的后端Server都要接入SSO校验登录状态，从而保障业务系统间用户安全认证的一致性。

- *引用公共库*
每一个业务工程都是一个独立的前端工程，所以里面会有一些相同的依赖，如 Vue、moment、lodash 等。如果将这些内容都打包到各自的 vendor.js 里，则势必会导致代码冗余太多，浏览器运行内存压力增大。我们把这些公共依赖、公共组件、CSS、Fonts 等都放到一个工程里，由该工程进行打包，将依赖、组件 export，并以 UMD 的方式注入到全局。







<br/>

### 参考资料
- [微前端实践](https://juejin.im/post/5cadd7835188251b2f3a4bb0)
- [前端微服务整合之‘‘插拔式架构’‘实现方案](https://blog.csdn.net/lizhipeng123321/article/details/81868136)
- [用微前端的方式搭建类单页应用](https://www.cnblogs.com/meituantech/p/9604591.html)
- [实施微前端的六种方式](https://juejin.im/post/5b45d0ea6fb9a04fa42f9f1a)
- [「微前端」- 将微服务理念扩展到前端开发（实践篇）](https://www.jianshu.com/p/1f409df7de45)
- [微前端的前世今生](https://juejin.cn/post/7163481140165246983?searchId=202503242041583F9C65A0CFAD874C3E2C)