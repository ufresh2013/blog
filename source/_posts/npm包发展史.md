---
title: NPM包发展史
date: 2020-04-15 14:35:59
category: NodeJS
---

### 1. 在没有包管理器前
正确来说 Node.js 是不存在没有包管理器的时期的。2009 年 Node.js 问世的时候 NPM 的雏形也发布了。
而在2009年之前，那时候做得最多的事情是：在网上找包，如 jQuery。找到下载地址，下载 放到项目中一个叫 libs 的目录，或者直接将 CDN 链接粘贴到 HTML 中。


### 2. npm v1-v2
2009 年，Node.js 诞生，npm（Node.js Package Manager）的雏形也正在酝酿。
​2011 年，npm 发布了 1.0 版本。
这一版npm带来的node_modules文件结构，是嵌套结构。
此时，node_modules的嵌套深度十分可怕，堪比黑洞。只有当所有子叶都不再依赖第三方包时，这棵树才能走到尽头。
一个库，被不同的包依赖了，那么它就会被安装两次，这种嵌套结构很快就能把磁盘占满。相信早期npm的windows用户都见过这个弹窗：

（node_modules文件夹无法删除，因为超过了windows能处理的最大路径）


### 3. yarn & npm v3
2016年，yarn诞生了。yarn解决了npm几个最为迫在眉睫的问题：
- 安装太慢 -> 加缓存，多线程
- 嵌套结构 -> 扁平化
- 无依赖锁 -> yarn.lock
yarn带来的扁平化结构，使得实际需要安装的包数量大大减少，再加上首发的缓存机制，使得依赖安装的速度大幅提升。


#### 3.1 yarn.lock依赖锁
相对于扁平化结构，yarn更大的贡献是发明了yarn.lock。而npm在一年后的v5才跟上了步伐，发布了package-lock.json。在没有依赖锁的年代，即使没有改变一行代码，一次`npm install`带来的实际代码量变更很可能是巨大的。

因为npm采用了语义化版本约定，简单来说，a.b.c代表着
- a 主版本号：当你做了不兼容的 API 修改
- b 次版本号：当你做了向下兼容的功能性新增
- c 修订号：当你做了向下兼容的问题修正